= Getting set up with Amazon Web Services
Ryan Schuetzler <ryan@schuetzler.net>
v0.2, 2023-01-10
ifndef::bound[:imagesdir: figs]
:icons: font
:source-highlighter: rouge
:rouge-style: github
:xrefstyle: short

Last updated: {revdate}

Amazon Web Services (AWS) is one of the largest providers of cloud computing services in the world.
They offer a huge array of services, from databases to VMs to speech recognition.
While there are hundreds of cloud providers to choose from, it's a smart career move to get familiar with AWS because of their market share.
In this lab you will use AWS Academy, Amazon's educational program, to get some free credit that you can use to create servers on Amazon's infrastructure.

IMPORTANT: When you are done with the lab, you can manually stop the lab, or you can just let it stop itself after 4 hours. You will accumulate charges only if you have an EC2 instance or other service running.

== Objectives

* Sign up for AWS Academy
* Become familiar with the AWS Academy lab portal
* Create a virtual machine on AWS and connect to it from your computer
* Create a static website on AWS that can be accessed from anywhere

== Signing up for AWS Academy
The first step to getting set up is to sign up for AWS Academy.
As a university student, you have access to (some) AWS resources for free, including a large set of courses that you can use to learn about what AWS can do.
If you are enrolled in one of my classes, you should be able to access AWS Educate through a link in your course.

. Check your email for a signup link from AWS Academy.
. You can then continue with the lab starting with <<academy-lms,the AWS Academy LMS>>.

== [[academy-lms]]The AWS Academy LMS

As I already explained, AWS Academy is Amazon's student developer partnership that gives you access to a whole bunch of free learning resources.
We will use some of the free academy credits for activities in this course.
After the course is over, you might have some credits left over that you can play with.

In the LMS modules page, you'll see a link to the student guide and another link to the Learner Lab.
To enable AWS services, you'll go through the "Learner Lab" link.
Once there, you'll be able to start the lab.

The "Lab" in the AWS Academy is a temporary environment for working with AWS services.
To help students avoid situations where they turn on a big server, leave it running, and run out of credits in the first week of class, the AWS Lab turns off most services after 4 hours.
In AWS, a "running" server is one that is currently turned on; a "stopped" server is one that is currently shut down; and a "terminated" server is deleted.
So when your services stop after 4 hours, that doesn't mean your work is gone. 
It just means you have to come back and turn the lab on to get it running again.

== Starting the Lab

The first thing you need to do is start your AWS Academy Lab environment. 
This is AWS's way of controlling your spending as you're learning how things work, and preventing you from using the lab environment to run enterprise websites.
This environment runs for 4 hours, then automatically shuts down (but doesn't delete) all servers and services you are running.

To start the lab, you will go to the modules page of the Learner Lab course.
Once there, you can click the Learner Lab link. You may have to turn off your adblocker to enable this page to function. 

[IMPORTANT] 
====
If you're on Chrome, you might have to search for the little eye icon on the right side of the address bar to enable some cross-site cookies that are required for the site to function.

image::chrome-eye.png[]
====

Then you can click the "Start Lab" button at the top of the page. 
The first time you run it, starting the lab will take 5-10 minutes, since AWS is creating a brand new environment for you to work in.
In the future it will start up much more quickly.

Once you have started the lab, you should see a screen like the one below. 
In the middle is a console that will let you interact with your lab environment directly with the AWS CLI (command line interface) -- it's labeled with a 1 in the screenshot below. 
Before we get into that, though, we'll take a look at the AWS Management Console. 
Access the management console by clicking the AWS link (labeled with 2).
You may need to allow popups on this page to let the management console window open.

image::learner-lab-console.png[title="Learner Lab Console"]


== Starting a server

The simplest and most basic thing you will want to do to get started with AWS is to start up a virtual machine server. 
On AWS, these servers are called "EC2 Instances."
Your EC2 server will be running in an Amazon data center somewhere in Virginia, and we will connect to it using the Secure Shell (SSH) protocol.

TIP: EC2 stands for Elastic Compute Cloud. You'll notice as you look around AWS that there are a lot of acronyms and weird names for things.  Check out https://expeditedsecurity.com/aws-in-plain-english/[AWS in plain English] to get an idea what some of them mean. And that's just a start! Look at https://aws.amazon.com/products/ for a bigger AWS product list.

We're first going to create an EC2 instance.

== Steps involved to create a static website

=== Create an instance
 
Go to the AWS Management Console and then launch a virtual machine with EC2.

* On the management console homepage, search for "EC2" to get to the EC2 dashboard
    
image::mgmt_console.png[title="AWS Management Console"]

* Click the orange "Launch instance" button to get into to instance creation wizard

image::launch-instance.png[title="Launch instance button"]

* Give the instance a name, such as "MyFirstInstance"  
* Next you will chose the Amazon Machine Image (AMI). An AMI is a template that contains the software configuration (operating system, application server, and applications) required to launch your instance. Select Amazon Linux from the quick start menu, and leave the other selections as their default.

image::AMI.png[title="AMI"]

* Choose an Instance Type which is free tier eligible e.g., t2.micro. Amazon EC2 provides a wide selection of instance types optimized to fit different use cases. Instances are virtual servers that can run applications. Click Next.

image::instance_type.png[title="Instance Type"]

* Under *Key pair (login)*, select vockey. This will be the way that you authenticate to log into the server. 
You can create a new keypair if you know what you're doing, but using `vockey` is easy, and the key is already created for you.

* Under the network and firewall settings, create a new security group and check the boxes to allow SSH traffic from anywhere, and HTTPS and HTTP traffic from the internet. 
A security group is a set of firewall rules that control the traffic for your instance. 
On this page, you can add rules to allow specific traffic to reach your instance. 
For example, if you want to set up a web server and allow Internet traffic to reach your instance, add rules that allow unrestricted access to the HTTP and HTTPS ports.

* Keep default options for storage

* Under *Advanced details*, under the option for *IAM instance profile*, select the option for `LabInstanceProfile`. Leave the rest of the advanced options as they are.

image::advanced-details.png[title="Advanced details pane"]

* Click the button to launch your instance.
    
=== Connect to your instance

Congratulations! You now have a server that is running in a datacenter somewhere in Virginia. That's cool and all, but fairly useless unless you can connect with that instance and tell it to do something. So that's what we'll do next. 

There are lots of ways to connect to your EC2 instance.
Going through all those and explaining the differences will be a topic for another activity. 
Today we're going to do it the easiest way possible - AWS Instance Connect.

* Return to the EC2 Dashboard
* Click on Instances to go to your list of instances. There you will see a list of instances (that will probably just be your MyFirstInstance).

image::ec2-dashboard.png[title="EC2 Dashboard"]

* Click on the Instance ID of your instance to pull up detailed information.
* On the detail page, click "Connect" in the upper right. That will pull up a page with options for how to connect to your instance. 

image::connection-page.png[title="EC2 Instance Connect"]

* Click the orange *Connect* button. A new window should open with a big black screen that has an EC2 ASCII art graphic and "Amazon Linux 2 AMI"

image::ssh-window.png[title="Instance Connect SSH window"]
  
* Switch to the root user by invoking command 

```
  sudo su -
```

* Type `mkdir -p /var/www/html` to create the `/var/www/html` directory (make sure to type it EXACTLY as written - `/var/`...)

* Type `cd /var/www/html` (again, make sure you include the first `/`)
  
* Create index.html file using the `nano` editor.

```
  nano index.html
```

TIP: `nano` is a command line text editor. It does the same thing that Notepad or VS Code does for editing a file, but entirely within the command prompt that you see. Once you have written the code you want to have on your page, use the keyboard shortcuts at the bottom to save the changes. (Hint: you want to Write Out the file changes before you close the editor, or you may lose your changes) (Hint 2: `^` is the symbol for the Ctrl key--even on a Mac)
  
*  Add some html contents in this file. Add and edit the html file to see the changes.
  
[source,html]
----
<html>
<head>
    <title>My Website</title>
</head>
<body>
    <h1>Welcome to my website</h1>
</body>
</html>
----

* Install Apache web server through command.  
[source,shell]
```
  yum install httpd
```
  
* Start the server.
[source,console]
```
  service httpd start
```
  
* Check the status. It should be in running stage.
[source,shell]
```
  service httpd status
```

=== Access your site

Once you've got all that done, it's time to enjoy the fruits of your labors.
Go back to your instance details (in the AWS Management Console) and find the *Public IPv4 address* section. 
Click on the button to "open address," then in the browser's address bar, edit the `https://` to be `http://` (we'll get security set up another time).
Accept whatever warnings your browser puts up about accessing insecure websites, and you should see your website! 
If others around you are done with their sites, visit their pages by going to `http://x.x.x.x` (replacing `x.x.x.x` with whatever their public IPv4 address is)

  

== Ideas for Exploration
There are so many services on AWS that you could play around with.
With the starter account you won't have access to everything, but you'll be able to play around with a lot of the services that would be needed to create a website.
Also, with the starter account you can use whatever services you want and when the credits run out, your services will shut down, so you won't be charged.

Investigate some other services available on AWS, and learn what they do and how to use them. You can find the full list at https://aws.amazon.com/products/. 
To see which services you can use with your student account, scroll down on the right side of the Academy Lab page. The section titled "Service usage and other restrictions" describes what you can do, and what limits your account has.
It can be overwhelming to see dozens or even hundreds of options, but with time and experience, it will become less confusing. 

You can also play around by making your website more complex. Currently there is only one page (`index.html`). 
How would you create a second page and link to that? 
What about adding a stylesheet to make your page look pretty?

TIP: When you are done with the lab, you can go back to the Academy page and stop the lab to stop accruing charges for your instance. You don't have to do this, because the instance you are using is in the free tier and already isn't costing you anything. And even if you left it running for an entire semester, it would only use approximately $40 of your charges. 
